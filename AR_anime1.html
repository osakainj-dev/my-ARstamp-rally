<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>AR Sky Parade</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    <script src="https://raw.githack.com/fcor/arjs-gestures/master/dist/gestures.js"></script>
</head>

<body style="margin: 0; overflow: hidden;">
    <a-scene 
      embedded 
      arjs="sourceType: webcam; debugUIEnabled: false;" 
      vr-mode-ui="enabled: false"
      gesture-detector>
      
      <a-assets>
        <a-asset-item id="shark-model" src="./whale_shark.glb"></a-asset-item>
        <a-asset-item id="balloon-model" src="./peachy_balloon_gift-v1.glb"></a-asset-item>
      
        <a-mixin id="move-logic" 
          animation__pos="property: position; from: 0 20 -150; to: 0 20 300; dur: 35000; easing: linear; loop: true">
        </a-mixin>
      </a-assets>
      
    <a-entity 
      id="shark"
      gltf-model="#shark-model" 
      class="clickable"
      scale="1 1 1" 
      gesture-handler="minScale: 0.0001; maxScale: 10"
      animation="property: position; from: -10 25 -200; to: -10 25 300; dur: 45000; easing: linear; loop: true">
    </a-entity>
    
    <a-entity 
      id="balloon"
      gltf-model="#balloon-model" 
      class="clickable"
      scale="0.01 0.01 0.01" 
      gesture-handler="minScale: 0.0001; maxScale: 1"
      position="10 20 -200"
      animation="property: position; from: 10 20 -200; to: 10 20 300; dur: 55000; easing: linear; loop: true; delay: 10000">
    </a-entity>
            
      <a-camera gps-camera rotation-reader></a-camera>
    </a-scene>

    <div id="overlay" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); color: white; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 9999;">
        <h2>St. Patrick's Sky Parade</h2>
        <p>画面をタップしてパレードを開始！</p>
        <button onclick="startExperience()" style="padding: 15px 30px; font-size: 20px; background: #009a49; border: none; color: white; border-radius: 10px;">☘️ 参加する</button>
    </div>

    <script>
      // モデル読み込み後の処理をここに記述
      window.onload = function() {
        const scene = document.querySelector('a-scene');
        scene.addEventListener('model-loaded', (e) => {
          const model = e.detail.model;
          model.traverse((node) => {
            const nodeName = node.name.toLowerCase();
            // 不要なパーツを隠す
            if (
              nodeName.includes('particles') ||
              nodeName.includes('ocean') ||
              nodeName.includes('plane') ||
              nodeName.includes('ground')
            ) {
              node.visible = false;
            }
          });
          console.log("モデルの調整が完了しました:", e.target.id);
        });
      };

      function startExperience() {
        document.getElementById('overlay').style.display = 'none';
      }
    </script>
</body>
</html>
