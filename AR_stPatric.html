<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>St. Patrick's Stamp Rally</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root {
            --irish-green: #009a49;
            --gold: #ffcd00;
            --dark-green: #00622d;
            --cream: #f8f4e3;
            --parchment: #fdf5e6;
        }

        body { font-family: 'Hiragino Kaku Gothic ProN', sans-serif; background-color: var(--cream); color: var(--dark-green); margin: 0; padding: 10px; }
        .container { max-width: 500px; margin: 0 auto; background: white; border: 4px double var(--gold); border-radius: 15px; padding: 15px; box-sizing: border-box; }

        /* --- ã‚¿ã‚¤ãƒˆãƒ«ç”»åƒã‚¨ãƒªã‚¢ã®ä¿®æ­£ --- */
        .title-image-container { 
            text-align: center; 
            margin-bottom: 15px; 
            width: 100%;
        }
        .title-image { 
            width: 100%;          /* ã‚³ãƒ³ãƒ†ãƒŠã®å¹…ã„ã£ã±ã„ã« */
            height: auto;         /* é«˜ã•ã¯è‡ªå‹•è¨ˆç®—ï¼ˆæ­ªã¾ãªã„ï¼‰ */
            max-width: 450px;     /* å¤§ãããªã‚Šã™ããªã„åˆ¶é™ */
            display: block;
            margin: 0 auto;
            border-radius: 10px;
        }

        #map { height: 250px; width: 100%; border-radius: 12px; margin-bottom: 15px; border: 2px solid var(--irish-green); }
        .check-btn { width: 100%; padding: 16px; font-size: 1.1rem; font-weight: bold; cursor: pointer; background: var(--irish-green); color: white; border: none; border-radius: 50px; box-shadow: 0 4px 0 var(--dark-green); margin-bottom: 20px; }
        .stamp-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 15px; }
        .stamp { background: #fff; border: 1.5px dashed var(--irish-green); border-radius: 8px; padding: 8px 2px; text-align: center; display: flex; flex-direction: column; align-items: center; justify-content: flex-start; min-height: 125px; box-sizing: border-box; }
        .stamp.goal { width: 75%; border: 3px double #ccc; background: #eee; min-height: 140px; color: #999; margin: 0 auto; }
        .stamp.goal.ready { border-color: var(--gold); background: #fffdf0; color: var(--dark-green); }
        .goal-container { margin-top: 10px; text-align: center; }
        .btn-ui { display: block; width: 90%; padding: 6px 0; margin: 2px 0; border-radius: 4px; font-size: 9px; font-weight: bold; text-decoration: none; text-align: center; cursor: pointer; }
        .detail-btn { background: white; color: var(--dark-green); border: 1px solid var(--gold); }
        .ar-btn { background: var(--irish-green); color: white; border: none; display: none; }
        .stamp.active { border-style: solid; background: #e8f5e9; }
        .stamp.active::before { content: 'â˜˜ï¸'; font-size: 16px; }
        .stamp.goal.active::before { content: 'ğŸŒˆ'; font-size: 22px; }
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; justify-content: center; align-items: center; }
        .modal-content { background-color: var(--parchment); width: 85%; max-width: 400px; padding: 20px; border-radius: 5px; border: 8px double var(--gold); position: relative; max-height: 85vh; overflow-y: auto; }
        .modal-close { position: absolute; top: 5px; right: 10px; font-size: 24px; cursor: pointer; }
        .modal-image { width: 100%; height: 180px; object-fit: cover; border-radius: 5px; border: 2px solid var(--gold); margin: 10px 0; }
        #status { text-align: center; font-weight: bold; margin-bottom: 10px; font-size: 14px; }
        .custom-marker { font-size: 26px; text-align: center; cursor: pointer; }
    </style>
</head>
<body>

<div class="container">
    <div class="title-image-container">
        <img src="./logo.png" alt="Shamrock Rally Logo" class="title-image">
    </div>

  <div class="intro-text" style="text-align: center; padding: 10px; font-size: 0.9rem; line-height: 1.5; color: var(--dark-green);">
    <p style="margin: 0; font-weight: bold;">è¡—ã‚’å·¡ã£ã¦ARã‚¹ã‚¿ãƒ³ãƒ—ã‚’é›†ã‚ã‚ˆã†ï¼</p>
    <p style="margin: 5px 0 0 0;">9ã¤ã®çŸ¥æµã‚’ã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆã—ã¦ã€<br>
        9ã¤ã®çŸ¥æµã‚’ã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆã—ã¦ã€æœ€çµ‚ãƒã‚¤ãƒ³ãƒˆã®ãƒ­ãƒƒã‚¯ã‚’è§£é™¤ã€‚<br>
        è™¹ã®éº“ã«éš ã•ã‚ŒãŸã‚´ãƒ¼ãƒ«ã‚’ç›®æŒ‡ã›ï¼â˜˜ï¸</p>
</div>
    
    <div id="map"></div>
    <div id="status">ã‚¹ã‚¿ãƒ³ãƒ—ã‚’é›†ã‚ã‚ˆã†ï¼</div>
    <button class="check-btn" onclick="checkLocation()">ç¾åœ¨åœ°ã§ã‚¹ã‚¿ãƒ³ãƒ—ï¼</button>

    <div class="stamp-grid" id="stamp-grid-main"></div>
    <div class="goal-container" id="goal-area"></div>
</div>

<div id="infoModal" class="modal-overlay" onclick="closeModal()">
    <div class="modal-content" onclick="event.stopPropagation()">
        <span class="modal-close" onclick="closeModal()">&times;</span>
        <h2 id="modalTitle" class="modal-title"></h2>
        <img id="modalImg" class="modal-image" src="" alt="">
        <div id="modalBody" class="modal-body"></div>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    const targets = {
        "1": { 
            name: "ä¸‰ã¤è‘‰ã®åºƒå ´", lat: 35.7725, lng: 139.6615, arUrl: "https://palanar.app/v2/ar_contents/ifo2026_2", 
            imgUrl: "https://images.unsplash.com/photo-1590076215667-873d3253503a?w=500", 
            description: "<b>ã€ã‚·ãƒ£ãƒ ãƒ­ãƒƒã‚¯ã€‘</b><br>ä¸‰ã¤è‘‰ã®ã‚¯ãƒ­ãƒ¼ãƒãƒ¼ã¯ã‚¢ã‚¤ãƒ«ãƒ©ãƒ³ãƒ‰ã®å›½èŠ±ã€‚è–ãƒ‘ãƒˆãƒªãƒƒã‚¯ãŒã‚­ãƒªã‚¹ãƒˆæ•™ã‚’åºƒã‚ã‚‹éš›ã€ã“ã®è‘‰ã‚’ä½¿ã£ã¦èª¬æ˜ã—ãŸã¨è¨€ã‚ã‚Œã¦ã„ã¾ã™ã€‚" 
        },
        "2": { 
            name: "å¦–ç²¾ã®é´å±‹", lat: 35.6812, lng: 139.7671, arUrl: "https://palanar.app/v2/ar_contents/copy_2c9648ec4f1ee40a", 
            imgUrl: "https://images.unsplash.com/photo-1599839619722-397514112634?w=500", 
            description: "<b>ã€ãƒ¬ãƒ—ãƒ©ã‚³ãƒ¼ãƒ³ã€‘</b><br>ä¸€äººã§é»™ã€…ã¨é´ã‚’ç›´ã™å¦–ç²¾ã€‚å½¼ã‚’æ•ã¾ãˆã‚Œã°é»„é‡‘ã®å ´æ‰€ã‚’æ•™ãˆã¦ãã‚Œã¾ã™ãŒã€ç›®ã‚’é›¢ã—ãŸéš™ã«é€ƒã’ã¦ã—ã¾ã†çŸ¥æµè€…ã§ã™ã€‚" 
        },
        "3": { 
            name: "ãƒ€ãƒ–ãƒªãƒ³ã®æ‰‰", lat: 35.6924, lng: 139.6971, arUrl: "https://palanar.com/ar_contents/ifo2026_1", 
            imgUrl: "https://images.unsplash.com/photo-1582234032482-628d7a868430?w=500", 
            description: "<b>ã€ã‚«ãƒ©ãƒ•ãƒ«ãªãƒ‰ã‚¢ã€‘</b><br>18ä¸–ç´€ã‹ã‚‰ç¶šããƒ€ãƒ–ãƒªãƒ³ã®ä¼çµ±ã€‚éš£ã®å®¶ã¨åŒã˜è‰²ã«ãªã‚‰ãªã„ã‚ˆã†ã«ã€ä½äººãŸã¡ãŒç«¶ã£ã¦é®®ã‚„ã‹ãªè‰²ã‚’å¡—ã£ãŸã®ãŒå§‹ã¾ã‚Šã§ã™ã€‚" 
        },
        "4": { 
            name: "åŸéŠè©©äººã®ç«ªç´", lat: 35.7000, lng: 139.7000, arUrl: "#", 
            imgUrl: "https://images.unsplash.com/photo-1595066601614-747f48037b52?w=500", 
            description: "<b>ã€ã‚¢ã‚¤ãƒªãƒƒã‚·ãƒ¥ãƒ»ãƒãƒ¼ãƒ—ã€‘</b><br>ã‚¢ã‚¤ãƒ«ãƒ©ãƒ³ãƒ‰ã®å›½ç« ã«ã‚‚ãªã£ã¦ã„ã‚‹ç«ªç´ã€‚ã‹ã¤ã¦åŸéŠè©©äººãŸã¡ãŒç‹å®®ã§å¥ã§ãŸç¾ã—ã„æ—‹å¾‹ã¯ã€ä»Šã‚‚å›½ã®é­‚ã¨ã—ã¦æ„›ã•ã‚Œã¦ã„ã¾ã™ã€‚" 
        },
        "5": { 
            name: "å·¨äººã®é“", lat: 35.7100, lng: 139.7100, arUrl: "#", 
            imgUrl: "https://images.unsplash.com/photo-1547432041-319985223030?w=500", 
            description: "<b>ã€ã‚¸ãƒ£ã‚¤ã‚¢ãƒ³ãƒ„ãƒ»ã‚³ãƒ¼ã‚ºã‚¦ã‚§ãƒ¼ã€‘</b><br>ç«å±±æ´»å‹•ã§ã§ããŸä¸æ€è­°ãªå…­è§’å½¢ã®çŸ³æŸ±ç¾¤ã€‚ä¼èª¬ã§ã¯ã€å·¨äººãŒæ•µã«ä¼šã„ã«ã‚¹ã‚³ãƒƒãƒˆãƒ©ãƒ³ãƒ‰ã¸æ¸¡ã‚‹ãŸã‚ã«ä½œã£ãŸé“ã ã¨è¨€ã‚ã‚Œã¦ã„ã¾ã™ã€‚" 
        },
        "6": { 
            name: "ã‚±ãƒ«ãƒˆã®çµã³ç›®", lat: 35.7200, lng: 139.7200, arUrl: "#", 
            imgUrl: "https://images.unsplash.com/photo-1621236304191-382500028400?w=500", 
            description: "<b>ã€æ°¸é ã®ã‚·ãƒ³ãƒœãƒ«ã€‘</b><br>ä¸€ç­†æ›¸ãã®ã‚ˆã†ã«é€”åˆ‡ã‚Œãªã„æ¨¡æ§˜ã¯ã€Œæ°¸é ã€ã‚„ã€Œé­‚ã®ç¹‹ãŒã‚Šã€ã‚’è±¡å¾´ã—ã¦ã„ã¾ã™ã€‚ã‚±ãƒ«ãƒˆæ–‡åŒ–ãŒèª‡ã‚‹ã€ä¸–ç•Œã§æœ€ã‚‚ç¾ã—ã„å¹¾ä½•å­¦æ–‡æ§˜ã§ã™ã€‚" 
        },
        "7": { 
            name: "ç¾Šã®ä½ã‚€ä¸˜", lat: 35.7300, lng: 139.7300, arUrl: "#", 
            imgUrl: "https://images.unsplash.com/photo-1484557985045-edf25e08da73?w=500", 
            description: "<b>ã€ã‚¢ãƒ©ãƒ³ã‚»ãƒ¼ã‚¿ãƒ¼ã®æ•…éƒ·ã€‘</b><br>ã‚¢ã‚¤ãƒ«ãƒ©ãƒ³ãƒ‰ã®è¥¿æµ·å²¸ã«æµ®ã‹ã¶ã‚¢ãƒ©ãƒ³è«¸å³¶ã€‚ã“ã“ã§ç·¨ã¾ã‚Œã‚‹ã‚»ãƒ¼ã‚¿ãƒ¼ã®æ¨¡æ§˜ã«ã¯ã€æ¼å¸«ãŸã¡ã®å®‰å…¨ã¨å¤§æ¼ã®é¡˜ã„ãŒè¾¼ã‚ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚" 
        },
        "8": { 
            name: "ã‚¹ãƒ­ãƒ³ãƒãƒ£ï¼ã®é˜", lat: 35.7400, lng: 139.7400, arUrl: "#", 
            imgUrl: "https://images.unsplash.com/photo-1559526323-cb2f2fe2591b?w=500", 
            description: "<b>ã€ãƒ‘ãƒ–ã®æ–‡åŒ–ã€‘</b><br>ã‚¢ã‚¤ãƒ«ãƒ©ãƒ³ãƒ‰ã®ãƒ‘ãƒ–ã¯ã€éŸ³æ¥½ã¨ä¼šè©±ã‚’æ¥½ã—ã‚€ç¬¬2ã®å®¶ã€‚ã€ŒSlÃ¡inteï¼ˆã‚¹ãƒ­ãƒ³ãƒãƒ£ï¼‰ã€ã¨ã¯ã€Œã‚ãªãŸã®å¥åº·ã«ï¼ã€ã¨ã„ã†æ„å‘³ã®ä¹¾æ¯ã®è¨€è‘‰ã§ã™ã€‚" 
        },
        "9": { 
            name: "å®ˆè­·è–äººã®æ›¸", lat: 35.7500, lng: 139.7500, arUrl: "#", 
            imgUrl: "https://images.unsplash.com/photo-1521587760476-6c12a4b040da?w=500", 
            description: "<b>ã€ã‚±ãƒ«ã‚ºã®æ›¸ã€‘</b><br>ä¸–ç•Œã§æœ€ã‚‚ç¾ã—ã„æœ¬ã¨å‘¼ã°ã‚Œã‚‹ã€ä¸­ä¸–ã®è±ªè¯ãªå†™æœ¬ã€‚ãƒˆãƒªãƒ‹ãƒ†ã‚£ãƒ»ã‚«ãƒ¬ãƒƒã‚¸ã«ä¿ç®¡ã•ã‚Œã¦ã„ã‚‹ã‚¢ã‚¤ãƒ«ãƒ©ãƒ³ãƒ‰ã®è‡³å®ã®ä¸€ã¤ã§ã™ã€‚" 
        },
        "10": { 
            name: "ğŸŒˆ è™¹ã®éº“ã®é»„é‡‘", lat: 35.7600, lng: 139.7600, arUrl: "#", 
            imgUrl: "https://images.unsplash.com/photo-1518005020951-ecc84916723f?w=500", 
            description: "<b>ã€ã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆï¼ã€‘</b><br>ã™ã¹ã¦ã®ã‚¹ã‚¿ãƒ³ãƒ—ã‚’é›†ã‚ã€ã‚¢ã‚¤ãƒ«ãƒ©ãƒ³ãƒ‰ã®çŸ¥æµã‚’å­¦ã³ã¾ã—ãŸï¼è™¹ã®éº“ã«éš ã•ã‚ŒãŸé»„é‡‘ã®å£ºã‚’æ‰‹ã«ã™ã‚‹è³‡æ ¼ã¯ã€ã‚ãªãŸã®å¥½å¥‡å¿ƒãã®ã‚‚ã®ã§ã™ã€‚" 
        }
    };

    let map, markers = {};
    const storageKey = 'rally_locked_final_v3';

    function init() {
        const gridMain = document.getElementById('stamp-grid-main');
        const goalArea = document.getElementById('goal-area');
        for (let i = 1; i <= 10; i++) {
            const div = document.createElement('div');
            div.id = `stamp-${i}`;
            if (i === 10) {
                div.className = 'stamp goal';
                div.innerHTML = `<span id="goal-name">ğŸ”’ 9ã¤ã®ã‚¹ã‚¿ãƒ³ãƒ—ã‚’é›†ã‚ã¦</span><div id="goal-btns" style="display:none;"><div class="btn-ui detail-btn" onclick="openModal('10')">ğŸ” è§£èª¬</div><a href="#" class="btn-ui ar-btn" id="ar-link-10" target="_blank">â˜˜ï¸ AR</a></div>`;
                goalArea.appendChild(div);
            } else {
                div.className = 'stamp';
                div.innerHTML = `<span>${targets[i].name}</span><div class="btn-ui detail-btn" onclick="openModal('${i}')">ğŸ” è§£èª¬</div><a href="#" id="ar-link-${i}" class="btn-ui ar-btn" target="_blank">â˜˜ï¸ AR</a>`;
                gridMain.appendChild(div);
            }
        }
        map = L.map('map').setView([targets["1"].lat, targets["1"].lng], 13);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
        for (let id in targets) {
            markers[id] = L.marker([targets[id].lat, targets[id].lng], {
                icon: L.divIcon({ className:'custom-marker', html:(id=="10"?'ğŸ”’':'ğŸ“'), iconSize:[30,30] })
            }).addTo(map).bindPopup(id=="10" ? "9ã¤é›†ã‚ã‚‹ã¨è§£æ”¾ï¼" : targets[id].name);
        }
        updateDisplay();
    }

    function updateDisplay() {
        let stamps = JSON.parse(localStorage.getItem(storageKey)) || [];
        const mainCount = stamps.filter(id => id != "10").length;
        stamps.forEach(id => {
            if(id == "10") return;
            document.getElementById("stamp-" + id)?.classList.add("active");
            
            const arLnk = document.getElementById("ar-link-" + id);
            if (arLnk) {
                arLnk.href = targets[id].arUrl; // targetsãƒ‡ãƒ¼ã‚¿ã‹ã‚‰URLã‚’ã‚»ãƒƒãƒˆ
                arLnk.style.display = "block";  // ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
            }
            
            markers[id].setIcon(L.divIcon({ className:'custom-marker', html:'â˜˜ï¸', iconSize:[30,30] }));
        });
        const goalEl = document.getElementById("stamp-10");
        if (mainCount >= 9) {
            goalEl.classList.add("ready");
            document.getElementById("goal-name").innerText = targets["10"].name;
            
            const arLnk = document.getElementById("ar-link-" + id);
            if (arLnk) {
                arLnk.href = targets[id].arUrl; // targetsãƒ‡ãƒ¼ã‚¿ã‹ã‚‰URLã‚’ã‚»ãƒƒãƒˆ
                arLnk.style.display = "block";  // ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
            }
            
            markers["10"].setIcon(L.divIcon({ className:'custom-marker', html:'ğŸš©', iconSize:[30,30] }));
            markers["10"].getPopup().setContent(targets["10"].name);
        }
        if (stamps.includes("10")) {
            goalEl.classList.add("active");
            document.getElementById("ar-link-10").style.display = "block";
            markers["10"].setIcon(L.divIcon({ className:'custom-marker', html:'ğŸŒˆ', iconSize:[30,30] }));
        }
        document.getElementById("status").innerText = `é›†ã‚ãŸã‚¹ã‚¿ãƒ³ãƒ—: ${mainCount} / 9`;
    }
    
// ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆ¤å®š
    function checkLocation() {
        navigator.geolocation.getCurrentPosition(pos => {
            const { latitude, longitude } = pos.coords;
            let stamps = JSON.parse(localStorage.getItem(storageKey)) || [];
            const mainCount = stamps.filter(id => id != "10").length;
            let foundId = null;
            for (let id in targets) {
                const dist = getDistance(latitude, longitude, targets[id].lat, targets[id].lng);
                if (dist < 0.05) {
                    if (id == "10" && mainCount < 9) { alert("ã¾ã ã‚´ãƒ¼ãƒ«ã¯é–‹ã„ã¦ã„ã¾ã›ã‚“ï¼"); return; }
                    foundId = id; break;
                }
            }
            if (foundId) { saveStamp(foundId); updateDisplay(); alert("â˜˜ï¸ ãŠã‚ã§ã¨ã†ï¼ã‚¹ã‚¿ãƒ³ãƒ—ã‚’ã‚²ãƒƒãƒˆï¼"); }
            else alert("è¿‘ãã«ã‚¹ãƒãƒƒãƒˆãŒã‚ã‚Šã¾ã›ã‚“ã€‚åœ°å›³ã®ğŸ“ã‚’ç›®æŒ‡ã—ã¦ã­");
        });
    }

    function openModal(id) {
        document.getElementById('modalTitle').innerText = targets[id].name;
        document.getElementById('modalImg').src = targets[id].imgUrl;
        document.getElementById('modalBody').innerHTML = targets[id].description;
        document.getElementById('infoModal').style.display = 'flex';
    }
    function closeModal() { document.getElementById('infoModal').style.display = 'none'; }
    function getDistance(lat1,lng1,lat2,lng2){const R=6371;const dLat=(lat2-lat1)*Math.PI/180;const dLng=(lng2-lng1)*Math.PI/180;const a=Math.sin(dLat/2)**2+Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLng/2)**2;return R*2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));}
    function saveStamp(id){let stamps=JSON.parse(localStorage.getItem(storageKey))||[];if(!stamps.includes(id)){stamps.push(id);localStorage.setItem(storageKey,JSON.stringify(stamps));}}
    window.onload = init;
</script>
</body>
</html>
